{% extends "base.html" %}

{% block title %}앱 설치 안내 - 다이소 안성센터{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header text-center">
                <h4 class="mb-0">📱 앱 설치 안내</h4>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <div class="app-icon mb-3">
                        <i class="fas fa-mobile-alt fa-3x text-primary"></i>
                    </div>
                    <h5>WorkTracker 앱 설치하기</h5>
                    <p class="text-muted">홈 화면에 앱을 추가하여 더 편리하게 사용하세요</p>
                </div>

                <!-- 모바일 기기 안내 -->
                <div id="mobileGuide" style="display: none;">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-mobile-alt"></i> 모바일 기기 설치 방법</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary">📱 iOS (iPhone/iPad)</h6>
                                <ol class="small">
                                    <li>Safari 브라우저에서 이 페이지를 열어주세요</li>
                                    <li>하단의 <strong>공유</strong> 버튼을 탭하세요</li>
                                    <li><strong>홈 화면에 추가</strong>를 선택하세요</li>
                                    <li>앱 이름을 확인하고 <strong>추가</strong>를 탭하세요</li>
                                </ol>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-success">🤖 Android</h6>
                                <ol class="small">
                                    <li>Chrome 브라우저에서 이 페이지를 열어주세요</li>
                                    <li>상단의 <strong>메뉴</strong> 버튼을 탭하세요</li>
                                    <li><strong>홈 화면에 추가</strong>를 선택하세요</li>
                                    <li>앱 이름을 확인하고 <strong>추가</strong>를 탭하세요</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 데스크톱 안내 -->
                <div id="desktopGuide" style="display: none;">
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-desktop"></i> 데스크톱 설치 방법</h6>
                        <p class="mb-2">데스크톱에서는 모바일 기기에서 설치하는 것을 권장합니다.</p>
                        <ul class="mb-0 small">
                            <li>Chrome 브라우저에서 주소창 옆의 <strong>설치</strong> 버튼을 클릭하세요</li>
                            <li>또는 <strong>F12</strong>를 눌러 개발자 도구를 열고 모바일 모드로 전환하세요</li>
                        </ul>
                    </div>
                </div>

                <!-- 앱 기능 안내 -->
                <div class="app-features mb-4">
                    <h6>✨ 앱 설치 후 사용 가능한 기능</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success"></i> 홈 화면에서 바로 접근</li>
                                <li><i class="fas fa-check text-success"></i> 오프라인에서도 기본 기능 사용</li>
                                <li><i class="fas fa-check text-success"></i> 빠른 업무 등록 및 관리</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success"></i> 푸시 알림 지원</li>
                                <li><i class="fas fa-check text-success"></i> 네이티브 앱과 유사한 경험</li>
                                <li><i class="fas fa-check text-success"></i> 자동 업데이트</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- 설치 버튼 -->
                <div class="text-center mb-4">
                    <button id="installButton" class="btn btn-primary btn-lg" style="display: none;">
                        <i class="fas fa-download"></i> 앱 설치
                    </button>
                    <div id="installStatus" class="text-muted small"></div>
                </div>

                <!-- 문제 해결 -->
                <div class="troubleshooting">
                    <h6>🔧 설치가 안 되나요?</h6>
                    <div class="accordion" id="troubleshootingAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    설치 버튼이 보이지 않아요
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                <div class="accordion-body">
                                    <ul class="small">
                                        <li>Chrome, Safari, Edge 등 최신 브라우저를 사용하세요</li>
                                        <li>페이지를 새로고침해보세요</li>
                                        <li>브라우저 캐시를 삭제해보세요</li>
                                        <li>위의 수동 설치 방법을 따라해보세요</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                    설치 후 앱이 실행되지 않아요
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                <div class="accordion-body">
                                    <ul class="small">
                                        <li>홈 화면에서 앱 아이콘을 다시 탭해보세요</li>
                                        <li>앱을 삭제하고 다시 설치해보세요</li>
                                        <li>브라우저 설정에서 사이트 데이터를 확인해보세요</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> 대시보드로 돌아가기
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// 기기 타입 감지
function detectDevice() {
    const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isAndroid = /Android/.test(navigator.userAgent);
    
    if (isMobile) {
        document.getElementById('mobileGuide').style.display = 'block';
        if (isIOS) {
            document.querySelector('#mobileGuide .text-primary').parentElement.style.display = 'block';
            document.querySelector('#mobileGuide .text-success').parentElement.style.display = 'none';
        } else if (isAndroid) {
            document.querySelector('#mobileGuide .text-primary').parentElement.style.display = 'none';
            document.querySelector('#mobileGuide .text-success').parentElement.style.display = 'block';
        }
    } else {
        document.getElementById('desktopGuide').style.display = 'block';
    }
}

// PWA 설치 상태 확인
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    
    const installButton = document.getElementById('installButton');
    const installStatus = document.getElementById('installStatus');
    
    if (installButton) {
        installButton.style.display = 'inline-block';
        installButton.onclick = installApp;
        installStatus.textContent = '설치 버튼을 클릭하여 앱을 설치하세요.';
    }
});

function installApp() {
    if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
                document.getElementById('installStatus').textContent = '앱이 성공적으로 설치되었습니다!';
                document.getElementById('installButton').style.display = 'none';
            } else {
                document.getElementById('installStatus').textContent = '설치가 취소되었습니다.';
            }
            deferredPrompt = null;
        });
    }
}

window.addEventListener('appinstalled', (evt) => {
    document.getElementById('installStatus').textContent = '앱이 설치되었습니다! 홈 화면에서 앱을 실행하세요.';
    document.getElementById('installButton').style.display = 'none';
});

// 페이지 로드 시 실행
document.addEventListener('DOMContentLoaded', function() {
    detectDevice();
    
    // 설치 버튼이 없는 경우 안내 메시지
    if (!deferredPrompt) {
        document.getElementById('installStatus').textContent = '브라우저에서 자동 설치를 지원하지 않습니다. 위의 수동 설치 방법을 따라해주세요.';
    }
});
</script>

<style>
.app-icon i {
    border: 3px solid #0d6efd;
    border-radius: 50%;
    padding: 1rem;
    background-color: #f8f9fa;
}

.app-features ul li {
    padding: 0.25rem 0;
}

.troubleshooting {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid #dee2e6;
}

.accordion-button:not(.collapsed) {
    background-color: #e7f1ff;
    color: #0d6efd;
}
</style>
{% endblock %} 
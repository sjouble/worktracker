<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ë‹¤ì´ì†Œ ì•ˆì„±ì„¼í„°{% endblock %}</title>
    
    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="theme-color" content="#0d6efd">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="WorkTracker">
    <meta name="msapplication-TileColor" content="#0d6efd">
    <meta name="msapplication-config" content="/static/browserconfig.xml">
    
    <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- ì•„ì´ì½˜ -->
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='icons/icon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='icons/icon-16x16.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-152x152.png') }}">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">ë‹¤ì´ì†Œ ì•ˆì„±ì„¼í„°</a>
        </div>
    </nav>

    <div class="container mt-4">
        {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- PWA ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ -->
    <script>
        // PWA ì„¤ì¹˜ ìƒíƒœ í™•ì¸
        let deferredPrompt;
        let installButton = document.getElementById('installButton');
        
        // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(registration => {
                        console.log('SW ë“±ë¡ ì„±ê³µ:', registration.scope);
                        checkInstallability();
                    })
                    .catch(error => {
                        console.log('SW ë“±ë¡ ì‹¤íŒ¨:', error);
                        checkInstallability();
                    });
            });
        } else {
            console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
            checkInstallability();
        }
        
        // PWA ì„¤ì¹˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
        function checkInstallability() {
            // ë§¤ë‹ˆí˜ìŠ¤íŠ¸ í™•ì¸
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                console.log('PWA ê¸°ëŠ¥ ì§€ì›ë¨');
            }
            
            // ì„¤ì¹˜ ë²„íŠ¼ì´ ìˆëŠ”ì§€ í™•ì¸
            if (installButton) {
                console.log('ì„¤ì¹˜ ë²„íŠ¼ ìš”ì†Œ ë°œê²¬');
            } else {
                console.log('ì„¤ì¹˜ ë²„íŠ¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
        }
        
        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì´ë²¤íŠ¸
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt ì´ë²¤íŠ¸ ë°œìƒ');
            e.preventDefault();
            deferredPrompt = e;
            
            // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ
            if (installButton) {
                installButton.style.display = 'inline-block';
                installButton.addEventListener('click', installApp);
                console.log('ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œë¨');
            } else {
                console.log('ì„¤ì¹˜ ë²„íŠ¼ ìš”ì†Œê°€ ì—†ìŒ');
            }
        });
        
        // ì•± ì„¤ì¹˜ í•¨ìˆ˜
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ì‚¬ìš©ìê°€ ì•± ì„¤ì¹˜ë¥¼ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤');
                        if (installButton) {
                            installButton.style.display = 'none';
                        }
                    } else {
                        console.log('ì‚¬ìš©ìê°€ ì•± ì„¤ì¹˜ë¥¼ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤');
                    }
                    deferredPrompt = null;
                });
            } else {
                console.log('ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤');
            }
        }
        
        // ì•±ì´ ì´ë¯¸ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
        window.addEventListener('appinstalled', (evt) => {
            console.log('ì•±ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤');
            if (installButton) {
                installButton.style.display = 'none';
            }
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì¹˜ ë²„íŠ¼ ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            // ëª¨ë°”ì¼ì—ì„œ ìˆ˜ë™ ì„¤ì¹˜ ì•ˆë‚´ í‘œì‹œ
            if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                console.log('ëª¨ë°”ì¼ ê¸°ê¸° ê°ì§€ë¨');
                
                // ëª¨ë°”ì¼ ì„¤ì¹˜ ì•ˆë‚´ ë°°ë„ˆ í‘œì‹œ (ë¡œê·¸ì¸ í˜ì´ì§€ ë˜ëŠ” ëŒ€ì‹œë³´ë“œ)
                const mobileBanner = document.getElementById('mobileInstallBanner');
                if (mobileBanner) {
                    mobileBanner.style.display = 'block';
                }
                
                if (installButton) {
                    // ëª¨ë°”ì¼ì—ì„œëŠ” í•­ìƒ ì„¤ì¹˜ ì•ˆë‚´ ë²„íŠ¼ í‘œì‹œ
                    installButton.style.display = 'inline-block';
                    installButton.innerHTML = '<i class="fas fa-download"></i> ğŸ“± ì•± ì„¤ì¹˜ ì•ˆë‚´';
                    installButton.onclick = function() {
                        window.location.href = '/install';
                    };
                }
            }
        });
    </script>
</body>
</html> 
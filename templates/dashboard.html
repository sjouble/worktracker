{% extends "base.html" %}

{% block title %}대시보드 - WorkTracker{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>{{ username }}님의 업무 대시보드</h2>
            <div>
                <button class="btn btn-success me-2" onclick="exportExcel()">엑셀 다운로드</button>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#taskModal">새 업무 등록</button>
            </div>
        </div>
        
        {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
        {% endif %}
        
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">업무 목록</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>업무 유형</th>
                                <th>설명</th>
                                <th>상태</th>
                                <th>시작 시간</th>
                                <th>종료 시간</th>
                                <th>생성일</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="tasksTableBody">
                            {% for task in tasks %}
                            <tr data-task-id="{{ task.id }}">
                                <td>{{ task.task_type }}</td>
                                <td>{{ task.description }}</td>
                                <td>
                                    <span class="badge {% if task.status == '완료' %}bg-success{% else %}bg-warning{% endif %}">
                                        {{ task.status }}
                                    </span>
                                </td>
                                <td>{{ task.start_time }}</td>
                                <td>{{ task.end_time }}</td>
                                <td>{{ task.created_at }}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" onclick="editTask({{ task.id }})">수정</button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteTask({{ task.id }})">삭제</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 업무 등록/수정 모달 -->
<div class="modal fade" id="taskModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="taskModalTitle">새 업무 등록</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="mb-3">
                        <label for="taskType" class="form-label">업무 유형</label>
                        <select class="form-select" id="taskType" required>
                            <option value="">선택하세요</option>
                            <option value="인출">인출</option>
                            <option value="보충">보충</option>
                            <option value="입고지원">입고지원</option>
                            <option value="미출대응">미출대응</option>
                            <option value="단내리기">단내리기</option>
                            <option value="이고">이고</option>
                            <option value="과출">과출</option>
                            <option value="파손">파손</option>
                            <option value="기타">기타</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">설명</label>
                        <textarea class="form-control" id="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="status" class="form-label">상태</label>
                        <select class="form-select" id="status" required>
                            <option value="진행중">진행중</option>
                            <option value="완료">완료</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="startTime" class="form-label">시작 시간</label>
                                <input type="datetime-local" class="form-control" id="startTime" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="endTime" class="form-label">종료 시간</label>
                                <input type="datetime-local" class="form-control" id="endTime">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" onclick="saveTask()">저장</button>
            </div>
        </div>
    </div>
</div>
{% endblock %} 